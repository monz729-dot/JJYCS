<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파트너 주문 관리 - YSC 물류관리 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <style>
        @keyframes slide-up {
            0% { transform: translateY(100px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .animate-slide-up {
            animation: slide-up 0.3s ease-out;
        }

        .bg-gradient-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .shadow-blue {
            box-shadow: 0 4px 14px -2px rgba(59, 130, 246, 0.15);
        }

        .tab-button {
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: white;
            color: #1d4ed8;
            border-color: #3b82f6;
        }

        .tab-button:not(.active) {
            color: #6b7280;
        }

        .tab-button:not(.active):hover {
            background: rgba(59, 130, 246, 0.1);
            color: #1d4ed8;
        }

        .order-row {
            transition: all 0.3s ease;
        }

        .order-row:hover {
            background-color: rgba(59, 130, 246, 0.05);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .status-button {
            transition: all 0.3s ease;
        }

        .status-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .photo-preview {
            position: relative;
            overflow: hidden;
        }

        .photo-preview img {
            transition: transform 0.3s ease;
        }

        .photo-preview:hover img {
            transform: scale(1.05);
        }

        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }

        .qr-scan-area {
            background: linear-gradient(45deg, rgba(59, 130, 246, 0.1), rgba(147, 197, 253, 0.1));
            border: 2px dashed #60a5fa;
            transition: all 0.3s ease;
        }

        .qr-scan-area:hover {
            border-color: #3b82f6;
            background: linear-gradient(45deg, rgba(59, 130, 246, 0.15), rgba(147, 197, 253, 0.15));
        }

        .upload-area {
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 성공/에러 메시지 -->
    <div id="messageContainer" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 hidden">
        <div id="messageBox" class="px-4 py-2 rounded-lg shadow-lg animate-slide-up">
            <span id="messageText"></span>
        </div>
    </div>

    <!-- 메인 컨테이너 -->
    <div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100 p-4 space-y-6">
        <!-- 헤더 -->
        <div class="flex items-center gap-4 mb-6">
            <button
                onclick="navigateTo('partner-dashboard')"
                class="flex items-center gap-2 px-3 py-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-all"
            >
                <i data-lucide="arrow-left" class="h-4 w-4"></i>
                대시보드로
            </button>
            <div class="flex-1">
                <h1 class="text-xl text-blue-900">주문서 관리</h1>
                <p class="text-sm text-blue-600">입출고 관리 및 상태 업데이트</p>
            </div>
            <button
                onclick="openQRScanDialog()"
                class="flex items-center gap-2 px-4 py-2 bg-gradient-primary text-white hover:opacity-90 transition-opacity rounded-md"
            >
                <i data-lucide="qr-code" class="h-4 w-4"></i>
                QR 스캔
            </button>
        </div>

        <!-- 필터 및 검색 -->
        <div class="bg-white rounded-lg shadow-blue border-blue-100 border">
            <div class="p-6 border-b border-blue-100">
                <h2 class="text-xl font-semibold text-blue-900">필터 및 검색</h2>
            </div>
            <div class="p-6 space-y-4">
                <!-- 탭 메뉴 -->
                <div class="grid grid-cols-3 bg-blue-50/50 rounded-lg p-1 gap-1">
                    <button 
                        id="allTab" 
                        class="tab-button py-2 px-4 rounded-md transition-all duration-300 text-sm font-medium active"
                        onclick="switchTab('all')"
                    >
                        전체
                    </button>
                    <button 
                        id="seaTab" 
                        class="tab-button py-2 px-4 rounded-md transition-all duration-300 text-sm font-medium"
                        onclick="switchTab('sea')"
                    >
                        해상
                    </button>
                    <button 
                        id="airTab" 
                        class="tab-button py-2 px-4 rounded-md transition-all duration-300 text-sm font-medium"
                        onclick="switchTab('air')"
                    >
                        항공
                    </button>
                </div>

                <!-- 검색 및 날짜 필터 -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-blue-900">검색</label>
                        <div class="relative">
                            <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"></i>
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="관리번호, 고객명, 관리코드..."
                                class="w-full pl-10 pr-4 py-2 border border-blue-200 rounded-md focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all"
                                oninput="filterOrders()"
                            />
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-blue-900">시작 날짜</label>
                        <input
                            type="date"
                            id="dateFrom"
                            class="w-full px-4 py-2 border border-blue-200 rounded-md focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all"
                            onchange="filterOrders()"
                        />
                    </div>
                    
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-blue-900">종료 날짜</label>
                        <input
                            type="date"
                            id="dateTo"
                            class="w-full px-4 py-2 border border-blue-200 rounded-md focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all"
                            onchange="filterOrders()"
                        />
                    </div>
                </div>
            </div>
        </div>

        <!-- 주문 목록 -->
        <div class="bg-white rounded-lg shadow-blue border-blue-100 border">
            <div class="p-6 border-b border-blue-100">
                <h2 class="text-xl font-semibold text-blue-900">
                    주문 목록 (<span id="orderCount">0</span>)
                </h2>
            </div>
            <div class="p-6">
                <!-- 데스크톱 테이블 -->
                <div class="hidden md:block overflow-x-auto">
                    <div class="min-w-full">
                        <div class="grid grid-cols-7 gap-4 p-3 bg-blue-50/50 rounded-t-lg text-sm font-medium text-blue-800">
                            <div>관리번호</div>
                            <div>관리코드</div>
                            <div>박스정보</div>
                            <div>내품정보</div>
                            <div>고객정보</div>
                            <div>출고일자</div>
                            <div>상태</div>
                        </div>
                        
                        <div id="orderList" class="divide-y divide-blue-100">
                            <!-- 주문이 여기에 동적으로 추가됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 모바일 카드 -->
                <div class="md:hidden space-y-4" id="orderCards">
                    <!-- 모바일 카드가 여기에 동적으로 추가됩니다 -->
                </div>

                <!-- 빈 목록 메시지 -->
                <div id="emptyMessage" class="text-center py-8 hidden">
                    <i data-lucide="package" class="h-12 w-12 text-gray-400 mx-auto mb-4"></i>
                    <p class="text-gray-500">조건에 맞는 주문이 없습니다.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- QR 스캔 모달 -->
    <div id="qrScanModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">QR 코드 스캔</h3>
                    <button onclick="closeQRScanDialog()" class="text-gray-400 hover:text-gray-600">
                        <i data-lucide="x" class="h-5 w-5"></i>
                    </button>
                </div>
                <p class="text-sm text-gray-600 mt-2">박스의 QR 코드를 스캔하거나 직접 입력하세요.</p>
            </div>
            
            <div class="p-6 space-y-4">
                <div class="qr-scan-area text-center p-8 rounded-lg">
                    <i data-lucide="qr-code" class="h-16 w-16 text-blue-400 mx-auto mb-4"></i>
                    <p class="text-blue-600">QR 코드를 여기에 스캔하세요</p>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">또는 직접 입력</label>
                    <input
                        type="text"
                        id="qrInput"
                        placeholder="관리번호, 관리코드, 주문번호..."
                        class="w-full h-12 px-4 border border-gray-300 rounded-md focus:border-blue-500 focus:ring-1 focus:ring-blue-200"
                    />
                </div>
                
                <button 
                    onclick="handleQRScan()" 
                    class="w-full h-12 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                >
                    확인
                </button>
            </div>
        </div>
    </div>

    <!-- 주문 상세 모달 -->
    <div id="orderDetailModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i data-lucide="package" class="h-5 w-5 text-blue-600"></i>
                        <h3 class="text-lg font-semibold text-gray-900">주문 상세 정보</h3>
                    </div>
                    <button onclick="closeOrderDetailDialog()" class="text-gray-400 hover:text-gray-600">
                        <i data-lucide="x" class="h-5 w-5"></i>
                    </button>
                </div>
            </div>
            
            <div id="orderDetailContent" class="p-6 space-y-6">
                <!-- 주문 상세 내용이 여기에 동적으로 추가됩니다 -->
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let activeTab = 'all';
        let selectedOrder = null;
        let photoUpload = [];
        let isUploading = false;

        // 데모 주문 데이터
        let orders = [
            {
                managementNumber: 'YCS-2024120001',
                managementCode: 'MNG001',
                orderId: 'YCS-20241202001',
                customerId: 'KYP001',
                customerName: '김철수',
                customerEmail: 'kimcs@email.com',
                customerPhone: '010-1234-5678',
                customerType: 'general',
                shippingType: 'sea',
                country: 'thailand',
                recipientName: 'Somchai Jaidee',
                recipientAddress: '123 Sukhumvit Road, Watthana District, Bangkok',
                recipientPhone: '+66-81-234-5678',
                boxCount: 2,
                totalWeight: 3.5,
                totalVolume: 0.012,
                items: [
                    {
                        id: '1',
                        hscode: '6203.42',
                        description: '면제 남성용 바지',
                        quantity: 5,
                        weight: 2.5,
                        width: 30,
                        height: 20,
                        depth: 5,
                        unitPrice: 25.00
                    },
                    {
                        id: '2',
                        hscode: '8517.12',
                        description: '휴대폰',
                        quantity: 2,
                        weight: 1.0,
                        width: 15,
                        height: 8,
                        depth: 1,
                        unitPrice: 300.00
                    }
                ],
                orderDate: '2024-12-02',
                shippingDate: '2024-12-05',
                isShipped: false,
                status: 'received',
                photos: [],
                notes: ''
            },
            {
                managementNumber: 'YCS-2024120002',
                managementCode: 'MNG002',
                orderId: 'YCS-20241201003',
                customerId: 'KYC002',
                customerName: '박영희',
                customerEmail: 'park@company.com',
                customerPhone: '010-9876-5432',
                customerType: 'corporate',
                companyName: '(주)글로벌무역',
                shippingType: 'air',
                country: 'vietnam',
                recipientName: 'Nguyen Van A',
                recipientAddress: 'Ho Chi Minh City, Vietnam',
                recipientPhone: '+84-90-123-4567',
                boxCount: 1,
                totalWeight: 0.8,
                totalVolume: 0.005,
                items: [
                    {
                        id: '3',
                        hscode: '3304.99',
                        description: '화장품',
                        quantity: 20,
                        weight: 0.8,
                        width: 10,
                        height: 10,
                        depth: 5,
                        unitPrice: 15.00
                    }
                ],
                orderDate: '2024-12-01',
                isShipped: true,
                status: 'shipped',
                photos: [],
                notes: '우선 처리 완료'
            },
            {
                managementNumber: 'YCS-2024120003',
                managementCode: 'MNG003',
                orderId: 'YCS-20241130005',
                customerId: 'KYP003',
                customerName: '이민수',
                customerEmail: 'lee@email.com',
                customerPhone: '010-5555-6666',
                customerType: 'general',
                shippingType: 'sea',
                country: 'philippines',
                recipientName: 'Maria Santos',
                recipientAddress: 'Manila, Philippines',
                recipientPhone: '+63-917-123-4567',
                boxCount: 3,
                totalWeight: 5.2,
                totalVolume: 0.025,
                items: [
                    {
                        id: '4',
                        hscode: '9503.00',
                        description: '장난감',
                        quantity: 15,
                        weight: 5.2,
                        width: 25,
                        height: 15,
                        depth: 10
                    }
                ],
                orderDate: '2024-11-30',
                isShipped: false,
                status: 'hold',
                photos: [],
                notes: '통관 서류 확인 중'
            }
        ];

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            renderOrders();
        });

        // 탭 전환
        function switchTab(tab) {
            activeTab = tab;
            
            // 모든 탭 버튼에서 active 클래스 제거
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 선택된 탭에 active 클래스 추가
            document.getElementById(tab + 'Tab').classList.add('active');
            
            filterOrders();
        }

        // 주문 필터링
        function filterOrders() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            const filtered = orders.filter(order => {
                const matchesTab = activeTab === 'all' || order.shippingType === activeTab;
                const matchesSearch = searchTerm === '' || 
                    order.managementNumber.toLowerCase().includes(searchTerm) ||
                    order.customerName.toLowerCase().includes(searchTerm) ||
                    order.managementCode.toLowerCase().includes(searchTerm);
                
                const orderDate = new Date(order.orderDate);
                const matchesDateFrom = !dateFrom || orderDate >= new Date(dateFrom);
                const matchesDateTo = !dateTo || orderDate <= new Date(dateTo);
                
                return matchesTab && matchesSearch && matchesDateFrom && matchesDateTo;
            });
            
            renderOrders(filtered);
        }

        // 주문 목록 렌더링
        function renderOrders(filteredOrders = orders) {
            const orderList = document.getElementById('orderList');
            const orderCards = document.getElementById('orderCards');
            const orderCount = document.getElementById('orderCount');
            const emptyMessage = document.getElementById('emptyMessage');
            
            orderCount.textContent = filteredOrders.length;
            
            if (filteredOrders.length === 0) {
                orderList.innerHTML = '';
                orderCards.innerHTML = '';
                emptyMessage.classList.remove('hidden');
                return;
            }
            
            emptyMessage.classList.add('hidden');
            
            // 데스크톱 테이블 렌더링
            orderList.innerHTML = filteredOrders.map(order => `
                <div class="order-row grid grid-cols-7 gap-4 p-3 cursor-pointer rounded-lg" onclick="openOrderDetail('${order.managementNumber}')">
                    <div>
                        <button class="text-blue-600 hover:text-blue-700 hover:underline font-medium">
                            ${order.managementNumber}
                        </button>
                    </div>
                    <div>
                        <div class="flex items-center gap-2">
                            <span class="font-mono text-sm">${order.managementCode}</span>
                            ${getShippingTypeBadge(order.shippingType)}
                        </div>
                    </div>
                    <div>
                        <div class="text-sm">
                            <p>${order.boxCount}박스</p>
                            <p class="text-gray-500">${order.totalWeight}kg</p>
                        </div>
                    </div>
                    <div>
                        <div class="text-sm">
                            <p>${order.items.length}종류</p>
                            <p class="text-gray-500">${getCountryName(order.country)}</p>
                        </div>
                    </div>
                    <div>
                        <div class="text-sm">
                            <p class="font-medium">${order.customerName}</p>
                            <p class="text-gray-500">${order.customerId}</p>
                        </div>
                    </div>
                    <div>
                        <div class="text-sm">
                            ${order.shippingDate ? order.shippingDate : '-'}
                        </div>
                    </div>
                    <div>
                        ${getStatusBadge(order.status)}
                    </div>
                </div>
            `).join('');

            // 모바일 카드 렌더링
            orderCards.innerHTML = filteredOrders.map(order => `
                <div class="bg-white border border-blue-100 rounded-lg p-4 cursor-pointer order-row" onclick="openOrderDetail('${order.managementNumber}')">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <p class="font-medium text-blue-600">${order.managementNumber}</p>
                            <p class="text-sm text-gray-500">${order.managementCode}</p>
                        </div>
                        <div class="flex gap-2">
                            ${getShippingTypeBadge(order.shippingType)}
                            ${getStatusBadge(order.status)}
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="text-gray-500">고객</p>
                            <p class="font-medium">${order.customerName}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">박스/중량</p>
                            <p class="font-medium">${order.boxCount}박스 / ${order.totalWeight}kg</p>
                        </div>
                        <div>
                            <p class="text-gray-500">목적지</p>
                            <p class="font-medium">${getCountryName(order.country)}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">출고일자</p>
                            <p class="font-medium">${order.shippingDate || '-'}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 상태 배지
        function getStatusBadge(status) {
            switch (status) {
                case 'pending':
                    return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-50 text-yellow-700 border border-yellow-200">접수 대기</span>';
                case 'received':
                    return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200">입고 완료</span>';
                case 'processing':
                    return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-50 text-orange-700 border border-orange-200">처리 중</span>';
                case 'ready':
                    return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 border border-green-200">출고 준비</span>';
                case 'shipped':
                    return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-50 text-purple-700 border border-purple-200">출고 완료</span>';
                case 'hold':
                    return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-700 border border-red-200">출고 보류</span>';
                default:
                    return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border">알 수 없음</span>';
            }
        }

        // 배송 유형 배지
        function getShippingTypeBadge(type) {
            return type === 'air' ? 
                '<span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-sky-100 text-sky-700 border border-sky-200">항공</span>' :
                '<span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200">해상</span>';
        }

        // 국가명 변환
        function getCountryName(country) {
            switch (country) {
                case 'thailand': return '태국';
                case 'vietnam': return '베트남';
                case 'philippines': return '필리핀';
                case 'indonesia': return '인도네시아';
                default: return country;
            }
        }

        // QR 스캔 모달 열기
        function openQRScanDialog() {
            document.getElementById('qrScanModal').classList.remove('hidden');
        }

        // QR 스캔 모달 닫기
        function closeQRScanDialog() {
            document.getElementById('qrScanModal').classList.add('hidden');
            document.getElementById('qrInput').value = '';
        }

        // QR 스캔 처리
        function handleQRScan() {
            const qrValue = document.getElementById('qrInput').value;
            if (qrValue) {
                const foundOrder = orders.find(order => 
                    order.managementNumber === qrValue || 
                    order.managementCode === qrValue ||
                    order.orderId === qrValue
                );
                
                if (foundOrder) {
                    selectedOrder = foundOrder;
                    closeQRScanDialog();
                    openOrderDetail(foundOrder.managementNumber);
                    showMessage('QR 코드 스캔 성공!', 'success');
                } else {
                    showMessage('해당하는 주문을 찾을 수 없습니다.', 'error');
                }
            }
        }

        // 주문 상세 모달 열기
        function openOrderDetail(managementNumber) {
            const order = orders.find(o => o.managementNumber === managementNumber);
            if (!order) return;
            
            selectedOrder = order;
            renderOrderDetail(order);
            document.getElementById('orderDetailModal').classList.remove('hidden');
        }

        // 주문 상세 모달 닫기
        function closeOrderDetailDialog() {
            document.getElementById('orderDetailModal').classList.add('hidden');
            selectedOrder = null;
            photoUpload = [];
        }

        // 주문 상세 내용 렌더링
        function renderOrderDetail(order) {
            const content = document.getElementById('orderDetailContent');
            content.innerHTML = `
                <!-- 기본 정보 -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white border border-blue-100 rounded-lg">
                        <div class="p-4 border-b border-blue-100">
                            <h4 class="font-semibold text-blue-900">주문 정보</h4>
                        </div>
                        <div class="p-4 space-y-3">
                            <div class="flex justify-between">
                                <span class="text-blue-700">관리번호:</span>
                                <span class="font-medium font-mono">${order.managementNumber}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-blue-700">관리코드:</span>
                                <span class="font-medium font-mono">${order.managementCode}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-blue-700">주문번호:</span>
                                <span class="font-medium font-mono">${order.orderId}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-blue-700">배송유형:</span>
                                ${getShippingTypeBadge(order.shippingType)}
                            </div>
                            <div class="flex justify-between">
                                <span class="text-blue-700">주문일자:</span>
                                <span class="font-medium">${order.orderDate}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white border border-blue-100 rounded-lg">
                        <div class="p-4 border-b border-blue-100">
                            <h4 class="font-semibold text-blue-900">고객 정보</h4>
                        </div>
                        <div class="p-4 space-y-3">
                            <div class="flex items-center gap-3">
                                <i data-lucide="user" class="h-4 w-4 text-blue-600"></i>
                                <div>
                                    <p class="font-medium">${order.customerName}</p>
                                    <p class="text-sm text-gray-500">${order.customerId}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <i data-lucide="mail" class="h-4 w-4 text-blue-600"></i>
                                <span class="font-medium">${order.customerEmail}</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <i data-lucide="phone" class="h-4 w-4 text-blue-600"></i>
                                <span class="font-medium">${order.customerPhone}</span>
                            </div>
                            ${order.companyName ? `
                                <div class="flex items-center gap-3">
                                    <i data-lucide="building" class="h-4 w-4 text-blue-600"></i>
                                    <span class="font-medium">${order.companyName}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <!-- 수취인 정보 -->
                <div class="bg-white border border-blue-100 rounded-lg">
                    <div class="p-4 border-b border-blue-100">
                        <h4 class="font-semibold text-blue-900 flex items-center gap-2">
                            <i data-lucide="map-pin" class="h-5 w-5"></i>
                            수취인 정보
                        </h4>
                    </div>
                    <div class="p-4 space-y-3">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-blue-700 mb-1">수취인 이름</p>
                                <p class="font-medium">${order.recipientName}</p>
                            </div>
                            <div>
                                <p class="text-sm text-blue-700 mb-1">연락처</p>
                                <p class="font-medium">${order.recipientPhone}</p>
                            </div>
                            <div class="md:col-span-2">
                                <p class="text-sm text-blue-700 mb-1">배송지 주소</p>
                                <p class="font-medium">${order.recipientAddress}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 상품 목록 -->
                <div class="bg-white border border-blue-100 rounded-lg">
                    <div class="p-4 border-b border-blue-100">
                        <h4 class="font-semibold text-blue-900">상품 목록</h4>
                    </div>
                    <div class="p-4">
                        <div class="overflow-x-auto">
                            <div class="min-w-full">
                                <div class="grid grid-cols-6 gap-4 p-3 bg-blue-50/50 rounded-t-lg text-sm font-medium text-blue-800">
                                    <div>품목</div>
                                    <div class="text-center">수량</div>
                                    <div class="text-center">중량</div>
                                    <div class="text-center">크기</div>
                                    <div class="text-center">부피무게</div>
                                    ${order.customerType === 'corporate' ? '<div class="text-right">단가</div>' : '<div></div>'}
                                </div>
                                <div class="divide-y divide-blue-100">
                                    ${order.items.map(item => `
                                        <div class="grid grid-cols-6 gap-4 p-3">
                                            <div>
                                                ${order.customerType === 'corporate' ? `<p class="text-xs text-gray-500 mb-1">${item.hscode}</p>` : ''}
                                                <p class="font-medium">${item.description}</p>
                                            </div>
                                            <div class="text-center">${item.quantity}</div>
                                            <div class="text-center">${item.weight}kg</div>
                                            <div class="text-center">${item.width}×${item.height}×${item.depth}cm</div>
                                            <div class="text-center">${calculateVolumetricWeight(item).toFixed(2)}kg</div>
                                            <div class="text-right">${order.customerType === 'corporate' && item.unitPrice ? '$' + item.unitPrice.toFixed(2) : ''}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 상태 관리 -->
                <div class="bg-white border border-blue-100 rounded-lg">
                    <div class="p-4 border-b border-blue-100">
                        <h4 class="font-semibold text-blue-900">상태 관리</h4>
                    </div>
                    <div class="p-4 space-y-4">
                        <div class="flex items-center gap-4">
                            <span class="text-blue-700">현재 상태:</span>
                            ${getStatusBadge(order.status)}
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <button onclick="handleStatusChange('received')" class="status-button flex items-center justify-center gap-2 px-4 py-2 border border-blue-200 text-blue-600 hover:bg-blue-50 rounded-md transition-all">
                                <i data-lucide="check-circle" class="h-4 w-4"></i>
                                입고 완료
                            </button>
                            <button onclick="handleStatusChange('processing')" class="status-button flex items-center justify-center gap-2 px-4 py-2 border border-orange-200 text-orange-600 hover:bg-orange-50 rounded-md transition-all">
                                <i data-lucide="clock" class="h-4 w-4"></i>
                                처리 중
                            </button>
                            <button onclick="handleStatusChange('ready')" class="status-button flex items-center justify-center gap-2 px-4 py-2 border border-green-200 text-green-600 hover:bg-green-50 rounded-md transition-all">
                                <i data-lucide="package" class="h-4 w-4"></i>
                                출고 준비
                            </button>
                            <button onclick="handleStatusChange('shipped')" class="status-button flex items-center justify-center gap-2 px-4 py-2 border border-purple-200 text-purple-600 hover:bg-purple-50 rounded-md transition-all">
                                <i data-lucide="truck" class="h-4 w-4"></i>
                                출고 완료
                            </button>
                            <button onclick="handleStatusChange('hold')" class="status-button flex items-center justify-center gap-2 px-4 py-2 border border-red-200 text-red-600 hover:bg-red-50 rounded-md transition-all">
                                <i data-lucide="x-circle" class="h-4 w-4"></i>
                                출고 보류
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 내품 정보 확인 촬영 -->
                <div class="bg-white border border-blue-100 rounded-lg">
                    <div class="p-4 border-b border-blue-100">
                        <h4 class="font-semibold text-blue-900">내품 정보 확인</h4>
                    </div>
                    <div class="p-4 space-y-4">
                        <!-- 기존 사진들 -->
                        ${order.photos.length > 0 ? `
                            <div>
                                <h5 class="font-medium text-blue-800 mb-3">업로드된 사진</h5>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    ${order.photos.map((photo, index) => `
                                        <div class="relative aspect-square bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center">
                                            <i data-lucide="file-image" class="h-8 w-8 text-gray-400"></i>
                                            <span class="absolute bottom-1 left-1 text-xs text-gray-500 bg-white px-1 rounded">
                                                사진 ${index + 1}
                                            </span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- 새 사진 업로드 -->
                        <div>
                            <h5 class="font-medium text-blue-800 mb-3">새 사진 촬영/업로드</h5>
                            <div class="space-y-3">
                                <div class="flex gap-3">
                                    <button onclick="openFileDialog()" class="flex items-center gap-2 px-4 py-2 border border-blue-200 text-blue-600 hover:bg-blue-50 rounded-md transition-all">
                                        <i data-lucide="camera" class="h-4 w-4"></i>
                                        사진 촬영
                                    </button>
                                    <button onclick="openFileDialog()" class="flex items-center gap-2 px-4 py-2 border border-green-200 text-green-600 hover:bg-green-50 rounded-md transition-all">
                                        <i data-lucide="upload" class="h-4 w-4"></i>
                                        파일 선택
                                    </button>
                                </div>
                                
                                <input type="file" id="fileInput" accept="image/*" multiple capture="environment" style="display: none;" onchange="handlePhotoUpload(event)">

                                <!-- 업로드 예정 사진 미리보기 -->
                                <div id="photoPreview" class="hidden">
                                    <h6 class="font-medium text-gray-700 mb-2">업로드 예정 사진</h6>
                                    <div id="photoGrid" class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                                        <!-- 사진 미리보기가 여기에 추가됩니다 -->
                                    </div>
                                    
                                    <button id="savePhotosBtn" onclick="savePhotos()" class="w-full py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                        사진 저장
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 메모 -->
                <div class="bg-white border border-blue-100 rounded-lg">
                    <div class="p-4 border-b border-blue-100">
                        <h4 class="font-semibold text-blue-900">메모</h4>
                    </div>
                    <div class="p-4">
                        <textarea
                            id="orderNotes"
                            placeholder="처리 관련 메모를 입력하세요..."
                            class="w-full p-3 border border-gray-300 rounded-md focus:border-blue-500 focus:ring-1 focus:ring-blue-200 min-h-20"
                            oninput="updateOrderNotes()"
                        >${order.notes || ''}</textarea>
                    </div>
                </div>
            `;
            
            // 아이콘 다시 생성
            lucide.createIcons();
        }

        // 부피무게 계산
        function calculateVolumetricWeight(item) {
            return (item.width * item.height * item.depth) / 6000;
        }

        // 상태 변경
        function handleStatusChange(newStatus) {
            if (!selectedOrder) return;
            
            orders = orders.map(order => 
                order.managementNumber === selectedOrder.managementNumber
                    ? { ...order, status: newStatus }
                    : order
            );
            
            selectedOrder = { ...selectedOrder, status: newStatus };
            renderOrderDetail(selectedOrder);
            filterOrders();
            showMessage('상태가 업데이트되었습니다.', 'success');
        }

        // 파일 다이얼로그 열기
        function openFileDialog() {
            document.getElementById('fileInput').click();
        }

        // 사진 업로드 처리
        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files || []);
            if (files.length > 0) {
                photoUpload = [...photoUpload, ...files];
                renderPhotoPreview();
            }
        }

        // 사진 미리보기 렌더링
        function renderPhotoPreview() {
            const preview = document.getElementById('photoPreview');
            const grid = document.getElementById('photoGrid');
            
            if (photoUpload.length === 0) {
                preview.classList.add('hidden');
                return;
            }
            
            preview.classList.remove('hidden');
            grid.innerHTML = photoUpload.map((file, index) => `
                <div class="photo-preview relative aspect-square bg-gray-100 rounded-lg border border-gray-200 overflow-hidden">
                    <img
                        src="${URL.createObjectURL(file)}"
                        alt="업로드 예정 ${index + 1}"
                        class="w-full h-full object-cover"
                    />
                    <button
                        onclick="removePhoto(${index})"
                        class="absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs hover:bg-red-600 transition-colors"
                    >
                        <i data-lucide="x" class="h-3 w-3"></i>
                    </button>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // 사진 제거
        function removePhoto(index) {
            photoUpload = photoUpload.filter((_, i) => i !== index);
            renderPhotoPreview();
        }

        // 사진 저장
        function savePhotos() {
            if (!selectedOrder || photoUpload.length === 0) return;
            
            const saveBtn = document.getElementById('savePhotosBtn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<div class="flex items-center justify-center gap-2"><div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>업로드 중...</div>';
            
            // 사진 업로드 시뮬레이션
            setTimeout(() => {
                const photoUrls = photoUpload.map((_, index) => `photo_${Date.now()}_${index}.jpg`);
                
                orders = orders.map(order => 
                    order.managementNumber === selectedOrder.managementNumber
                        ? { ...order, photos: [...order.photos, ...photoUrls] }
                        : order
                );
                
                selectedOrder = { ...selectedOrder, photos: [...selectedOrder.photos, ...photoUrls] };
                photoUpload = [];
                renderOrderDetail(selectedOrder);
                showMessage('사진이 성공적으로 업로드되었습니다.', 'success');
            }, 2000);
        }

        // 주문 메모 업데이트
        function updateOrderNotes() {
            if (!selectedOrder) return;
            
            const notes = document.getElementById('orderNotes').value;
            
            orders = orders.map(order => 
                order.managementNumber === selectedOrder.managementNumber
                    ? { ...order, notes }
                    : order
            );
            
            selectedOrder = { ...selectedOrder, notes };
        }

        // 메시지 표시
        function showMessage(message, type = 'success') {
            const container = document.getElementById('messageContainer');
            const box = document.getElementById('messageBox');
            const text = document.getElementById('messageText');
            
            text.textContent = message;
            
            if (type === 'success') {
                box.className = 'px-4 py-2 rounded-lg shadow-lg animate-slide-up bg-green-100 text-green-800 border border-green-200';
            } else {
                box.className = 'px-4 py-2 rounded-lg shadow-lg animate-slide-up bg-red-100 text-red-800 border border-red-200';
            }
            
            container.classList.remove('hidden');
            
            setTimeout(() => {
                container.classList.add('hidden');
            }, 3000);
        }

        // 네비게이션
        function navigateTo(page) {
            console.log('Navigating to:', page);
            // 실제 프로젝트에서는 라우팅 로직 구현
        }
    </script>
</body>
</html>