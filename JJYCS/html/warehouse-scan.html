<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì°½ê³  ìŠ¤ìº” ì‹œìŠ¤í…œ - YCS LMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        .scan-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        
        #qr-reader {
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        
        .scan-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid #ef4444;
            width: 200px;
            height: 200px;
            border-radius: 8px;
            pointer-events: none;
        }
        
        .scan-result {
            transition: all 0.3s ease;
        }
        
        .scan-success {
            background: linear-gradient(135deg, rgb(34 197 94) 0%, rgb(22 163 74) 100%);
            color: white;
        }
        
        .scan-error {
            background: linear-gradient(135deg, rgb(239 68 68) 0%, rgb(220 38 38) 100%);
            color: white;
        }
        
        .operator-info {
            background: linear-gradient(135deg, rgb(59 130 246) 0%, rgb(37 99 235) 100%);
            color: white;
        }
        
        .scan-history-item {
            transition: all 0.2s ease;
        }
        
        .scan-history-item:hover {
            background: rgb(249 250 251);
            transform: translateX(4px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- í—¤ë” -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-4xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">ì°½ê³  ìŠ¤ìº” ì‹œìŠ¤í…œ</h1>
                        <p class="text-sm text-gray-600">QR/ë°”ì½”ë“œ ìŠ¤ìº”ìœ¼ë¡œ ì…ê³ /ì¶œê³  ì²˜ë¦¬</p>
                    </div>
                    <div class="operator-info px-4 py-2 rounded-lg">
                        <div class="text-xs font-medium opacity-80">ì‘ì—…ì</div>
                        <div id="operatorName" class="font-semibold">ê´€ë¦¬ì</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-4xl mx-auto px-4 py-6 space-y-6">
            <!-- ìŠ¤ìº” íƒ€ì… ì„ íƒ -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ì‘ì—… ìœ í˜• ì„ íƒ</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <button onclick="setScanType('INBOUND')" 
                            class="scan-type-btn py-3 px-4 rounded-lg border-2 border-blue-500 bg-blue-50 text-blue-700 font-medium text-sm transition-all"
                            id="btn-INBOUND">
                        ğŸ“¦ ì…ê³ 
                    </button>
                    <button onclick="setScanType('OUTBOUND')" 
                            class="scan-type-btn py-3 px-4 rounded-lg border-2 border-gray-200 text-gray-700 font-medium text-sm transition-all"
                            id="btn-OUTBOUND">
                        ğŸšš ì¶œê³ 
                    </button>
                    <button onclick="setScanType('HOLD')" 
                            class="scan-type-btn py-3 px-4 rounded-lg border-2 border-gray-200 text-gray-700 font-medium text-sm transition-all"
                            id="btn-HOLD">
                        â¸ï¸ ë³´ë¥˜
                    </button>
                    <button onclick="setScanType('INVENTORY')" 
                            class="scan-type-btn py-3 px-4 rounded-lg border-2 border-gray-200 text-gray-700 font-medium text-sm transition-all"
                            id="btn-INVENTORY">
                        ğŸ“‹ ì¬ê³ í™•ì¸
                    </button>
                </div>
                <div class="mt-3 text-sm text-gray-500">
                    í˜„ì¬ ì„ íƒ: <span id="currentScanType" class="font-medium text-blue-600">ì…ê³ </span>
                </div>
            </div>

            <!-- QR ìŠ¤ìºë„ˆ -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">QR/ë°”ì½”ë“œ ìŠ¤ìº”</h2>
                    <div class="flex gap-2">
                        <button onclick="startScanning()" id="startScanBtn"
                                class="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors">
                            ğŸ“· ìŠ¤ìº” ì‹œì‘
                        </button>
                        <button onclick="stopScanning()" id="stopScanBtn" style="display: none;"
                                class="px-4 py-2 bg-red-500 text-white rounded-lg text-sm font-medium hover:bg-red-600 transition-colors">
                            â¹ï¸ ìŠ¤ìº” ì •ì§€
                        </button>
                    </div>
                </div>
                
                <!-- ì¹´ë©”ë¼ ë·° -->
                <div class="scan-container">
                    <div id="qr-reader" style="display: none;"></div>
                    <div class="scan-overlay" id="scanOverlay" style="display: none;"></div>
                </div>
                
                <!-- ìˆ˜ë™ ì…ë ¥ -->
                <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ë˜ëŠ” ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”
                    </label>
                    <div class="flex gap-2">
                        <input type="text" id="manualInput" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="ì£¼ë¬¸ë²ˆí˜¸ ë˜ëŠ” ë°”ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        <button onclick="processManualInput()" 
                                class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-medium hover:bg-green-600 transition-colors">
                            âœ… ì²˜ë¦¬
                        </button>
                    </div>
                </div>
            </div>

            <!-- ìŠ¤ìº” ê²°ê³¼ -->
            <div id="scanResultSection" class="bg-white rounded-lg shadow-sm p-6" style="display: none;">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ìŠ¤ìº” ê²°ê³¼</h2>
                <div id="scanResult" class="scan-result p-4 rounded-lg"></div>
            </div>

            <!-- ì¶”ê°€ ì •ë³´ ì…ë ¥ -->
            <div id="additionalInfoSection" class="bg-white rounded-lg shadow-sm p-6" style="display: none;">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ì¶”ê°€ ì •ë³´</h2>
                <div class="space-y-4">
                    <div id="locationInput" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì°½ê³  ìœ„ì¹˜</label>
                        <input type="text" id="location" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="ì˜ˆ: A-01-03">
                    </div>
                    <div id="trackingInput" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìš´ì†¡ì¥ ë²ˆí˜¸</label>
                        <input type="text" id="trackingNumber" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="ì˜ˆ: EE123456789KR">
                    </div>
                    <div id="reasonInput" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë³´ë¥˜ ì‚¬ìœ </label>
                        <select id="holdReason" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">ì‚¬ìœ ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì†ìƒ">í¬ì¥ ì†ìƒ</option>
                            <option value="ë¶ˆì™„ì „">ë¶ˆì™„ì „í•œ íŒ¨í‚¤ì§€</option>
                            <option value="ì£¼ì†Œë¶ˆëª…">ìˆ˜ì·¨ì¸ ì£¼ì†Œ ë¶ˆëª…í™•</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ëª¨</label>
                        <textarea id="notes" rows="2" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                  placeholder="ì¶”ê°€ ë©”ëª¨ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                </div>
            </div>

            <!-- ìŠ¤ìº” íˆìŠ¤í† ë¦¬ -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">ìŠ¤ìº” ê¸°ë¡</h2>
                    <button onclick="clearHistory()" 
                            class="text-sm text-gray-500 hover:text-red-500 transition-colors">
                        ê¸°ë¡ ì‚­ì œ
                    </button>
                </div>
                <div id="scanHistory" class="space-y-2">
                    <div class="text-sm text-gray-500 text-center py-4">
                        ì•„ì§ ìŠ¤ìº” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </div>

            <!-- ì¼ê´„ ì²˜ë¦¬ -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ì¼ê´„ ì²˜ë¦¬</h2>
                <div class="flex gap-2 mb-4">
                    <button onclick="processBatch('INBOUND')" 
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors">
                        ì¼ê´„ ì…ê³ 
                    </button>
                    <button onclick="processBatch('OUTBOUND')" 
                            class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-medium hover:bg-green-600 transition-colors">
                        ì¼ê´„ ì¶œê³ 
                    </button>
                </div>
                <div class="text-sm text-gray-600">
                    ìŠ¤ìº”í•œ í•­ëª©ë“¤ì„ ì¼ê´„ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ëŒ€ê¸° ì¤‘ì¸ í•­ëª©: <span id="pendingCount" class="font-medium">0</span>ê°œ
                </div>
            </div>
        </div>
    </div>

    <script>
        let html5QrcodeScanner = null;
        let currentScanType = 'INBOUND';
        let scanHistory = [];
        let pendingScanCodes = [];

        // ìŠ¤ìº” íƒ€ì… ì„¤ì •
        function setScanType(type) {
            currentScanType = type;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.scan-type-btn').forEach(btn => {
                btn.className = 'scan-type-btn py-3 px-4 rounded-lg border-2 border-gray-200 text-gray-700 font-medium text-sm transition-all';
            });
            
            document.getElementById(`btn-${type}`).className = 'scan-type-btn py-3 px-4 rounded-lg border-2 border-blue-500 bg-blue-50 text-blue-700 font-medium text-sm transition-all';
            
            // í˜„ì¬ íƒ€ì… í‘œì‹œ ì—…ë°ì´íŠ¸
            const typeNames = {
                'INBOUND': 'ì…ê³ ',
                'OUTBOUND': 'ì¶œê³ ',
                'HOLD': 'ë³´ë¥˜',
                'INVENTORY': 'ì¬ê³ í™•ì¸'
            };
            document.getElementById('currentScanType').textContent = typeNames[type];
            
            // ì¶”ê°€ ì •ë³´ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¸°ê¸°
            showAdditionalInfoForType(type);
        }

        function showAdditionalInfoForType(type) {
            const section = document.getElementById('additionalInfoSection');
            const locationInput = document.getElementById('locationInput');
            const trackingInput = document.getElementById('trackingInput');
            const reasonInput = document.getElementById('reasonInput');
            
            // ëª¨ë“  ì…ë ¥ í•„ë“œ ìˆ¨ê¸°ê¸°
            locationInput.style.display = 'none';
            trackingInput.style.display = 'none';
            reasonInput.style.display = 'none';
            
            // íƒ€ì…ë³„ í•„ìš”í•œ í•„ë“œ í‘œì‹œ
            switch(type) {
                case 'INBOUND':
                    section.style.display = 'block';
                    locationInput.style.display = 'block';
                    break;
                case 'OUTBOUND':
                    section.style.display = 'block';
                    trackingInput.style.display = 'block';
                    break;
                case 'HOLD':
                    section.style.display = 'block';
                    reasonInput.style.display = 'block';
                    break;
                case 'INVENTORY':
                    section.style.display = 'block';
                    break;
                default:
                    section.style.display = 'none';
            }
        }

        // QR ìŠ¤ìº” ì‹œì‘
        function startScanning() {
            const config = { 
                fps: 10, 
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0
            };
            
            html5QrcodeScanner = new Html5Qrcode("qr-reader");
            
            Html5Qrcode.getCameras().then(devices => {
                if (devices && devices.length) {
                    const cameraId = devices[0].id;
                    
                    html5QrcodeScanner.start(
                        cameraId, 
                        config, 
                        onScanSuccess, 
                        onScanFailure
                    ).catch(err => {
                        console.error('ì¹´ë©”ë¼ ì‹œì‘ ì‹¤íŒ¨:', err);
                        showScanResult(false, 'ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + err);
                    });
                    
                    document.getElementById('qr-reader').style.display = 'block';
                    document.getElementById('scanOverlay').style.display = 'block';
                    document.getElementById('startScanBtn').style.display = 'none';
                    document.getElementById('stopScanBtn').style.display = 'inline-block';
                }
            }).catch(err => {
                console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨:', err);
                showScanResult(false, 'ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + err);
            });
        }

        // QR ìŠ¤ìº” ì •ì§€
        function stopScanning() {
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop().then(() => {
                    document.getElementById('qr-reader').style.display = 'none';
                    document.getElementById('scanOverlay').style.display = 'none';
                    document.getElementById('startScanBtn').style.display = 'inline-block';
                    document.getElementById('stopScanBtn').style.display = 'none';
                }).catch(err => {
                    console.error('ìŠ¤ìº” ì •ì§€ ì‹¤íŒ¨:', err);
                });
            }
        }

        // ìŠ¤ìº” ì„±ê³µ ì½œë°±
        function onScanSuccess(decodedText, decodedResult) {
            console.log('QR ìŠ¤ìº” ì„±ê³µ:', decodedText);
            stopScanning();
            processScan(decodedText);
        }

        // ìŠ¤ìº” ì‹¤íŒ¨ ì½œë°±
        function onScanFailure(error) {
            // ìŠ¤ìº” ì‹¤íŒ¨ëŠ” ì¼ë°˜ì ì¸ ìƒí™©ì´ë¯€ë¡œ ë¡œê·¸ë§Œ ë‚¨ê¹€
            // console.log('ìŠ¤ìº” ëŒ€ê¸° ì¤‘...', error);
        }

        // ìˆ˜ë™ ì…ë ¥ ì²˜ë¦¬
        function processManualInput() {
            const input = document.getElementById('manualInput');
            const code = input.value.trim();
            
            if (!code) {
                showScanResult(false, 'ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            processScan(code);
            input.value = '';
        }

        // ìŠ¤ìº” ì²˜ë¦¬ ë©”ì¸ í•¨ìˆ˜
        function processScan(scanCode) {
            console.log('ìŠ¤ìº” ì²˜ë¦¬ ì‹œì‘:', scanCode, currentScanType);
            
            const requestData = {
                labelCode: scanCode,
                scanType: currentScanType,
                location: document.getElementById('location').value || 'AUTO',
                notes: document.getElementById('notes').value || ''
            };

            // íƒ€ì…ë³„ ì¶”ê°€ ë°ì´í„°
            if (currentScanType === 'OUTBOUND') {
                requestData.trackingNumber = document.getElementById('trackingNumber').value || 'AUTO-' + Date.now();
            } else if (currentScanType === 'HOLD') {
                const reason = document.getElementById('holdReason').value;
                if (!reason) {
                    showScanResult(false, 'ë³´ë¥˜ ì‚¬ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                requestData.reason = reason;
            }

            // API í˜¸ì¶œ
            fetch('http://localhost:8081/api/warehouse/scan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('API ì‘ë‹µ:', data);
                if (data.success) {
                    showScanResult(true, data.message, data);
                    addToHistory(scanCode, currentScanType, data.message, true);
                    
                    // ì¼ê´„ ì²˜ë¦¬ìš© ëª©ë¡ì— ì¶”ê°€
                    if (currentScanType === 'INBOUND' || currentScanType === 'OUTBOUND') {
                        pendingScanCodes.push(scanCode);
                        updatePendingCount();
                    }
                } else {
                    showScanResult(false, data.error || 'ì²˜ë¦¬ ì‹¤íŒ¨');
                    addToHistory(scanCode, currentScanType, data.error || 'ì²˜ë¦¬ ì‹¤íŒ¨', false);
                }
            })
            .catch(error => {
                console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                showScanResult(false, 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ' + error.message);
                addToHistory(scanCode, currentScanType, 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨', false);
            });
        }

        // ìŠ¤ìº” ê²°ê³¼ í‘œì‹œ
        function showScanResult(success, message, data = null) {
            const section = document.getElementById('scanResultSection');
            const result = document.getElementById('scanResult');
            
            section.style.display = 'block';
            
            if (success) {
                result.className = 'scan-result scan-success p-4 rounded-lg';
                result.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xl">âœ…</span>
                        <span class="font-semibold">ì²˜ë¦¬ ì„±ê³µ</span>
                    </div>
                    <div class="text-sm opacity-90">${message}</div>
                    ${data && data.order ? `
                        <div class="mt-3 p-3 bg-white/20 rounded text-xs">
                            <div>ì£¼ë¬¸ë²ˆí˜¸: ${data.order.orderNumber}</div>
                            <div>ìƒíƒœ: ${data.order.status}</div>
                            ${data.location ? `<div>ìœ„ì¹˜: ${data.location}</div>` : ''}
                        </div>
                    ` : ''}
                `;
            } else {
                result.className = 'scan-result scan-error p-4 rounded-lg';
                result.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xl">âŒ</span>
                        <span class="font-semibold">ì²˜ë¦¬ ì‹¤íŒ¨</span>
                    </div>
                    <div class="text-sm opacity-90">${message}</div>
                `;
            }
            
            // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                section.style.display = 'none';
            }, 3000);
        }

        // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
        function addToHistory(scanCode, scanType, message, success) {
            const timestamp = new Date().toLocaleString('ko-KR');
            scanHistory.unshift({
                scanCode,
                scanType,
                message,
                success,
                timestamp
            });
            
            // ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ìœ ì§€
            if (scanHistory.length > 10) {
                scanHistory = scanHistory.slice(0, 10);
            }
            
            renderHistory();
        }

        // íˆìŠ¤í† ë¦¬ ë Œë”ë§
        function renderHistory() {
            const container = document.getElementById('scanHistory');
            
            if (scanHistory.length === 0) {
                container.innerHTML = `
                    <div class="text-sm text-gray-500 text-center py-4">
                        ì•„ì§ ìŠ¤ìº” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                return;
            }
            
            const typeNames = {
                'INBOUND': 'ì…ê³ ',
                'OUTBOUND': 'ì¶œê³ ', 
                'HOLD': 'ë³´ë¥˜',
                'INVENTORY': 'ì¬ê³ í™•ì¸'
            };
            
            container.innerHTML = scanHistory.map(item => `
                <div class="scan-history-item p-3 border border-gray-200 rounded-lg ${item.success ? 'border-l-4 border-l-green-500' : 'border-l-4 border-l-red-500'}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="${item.success ? 'text-green-600' : 'text-red-600'}">${item.success ? 'âœ…' : 'âŒ'}</span>
                                <span class="font-medium text-sm">${item.scanCode}</span>
                                <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded">${typeNames[item.scanType] || item.scanType}</span>
                            </div>
                            <div class="text-sm text-gray-600">${item.message}</div>
                        </div>
                        <div class="text-xs text-gray-400 ml-4">${item.timestamp}</div>
                    </div>
                </div>
            `).join('');
        }

        // íˆìŠ¤í† ë¦¬ ì‚­ì œ
        function clearHistory() {
            if (confirm('ìŠ¤ìº” ê¸°ë¡ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                scanHistory = [];
                renderHistory();
            }
        }

        // ì¼ê´„ ì²˜ë¦¬
        function processBatch(batchType) {
            if (pendingScanCodes.length === 0) {
                showScanResult(false, 'ì¼ê´„ ì²˜ë¦¬í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm(`${pendingScanCodes.length}ê°œ í•­ëª©ì„ ì¼ê´„ ${batchType === 'INBOUND' ? 'ì…ê³ ' : 'ì¶œê³ '} ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const endpoint = batchType === 'INBOUND' ? 'batch/inbound' : 'batch/outbound';
            
            fetch(`http://localhost:8081/api/warehouse/${endpoint}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    scanCodes: pendingScanCodes,
                    operatorId: 'warehouse-operator'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showScanResult(true, `ì¼ê´„ ì²˜ë¦¬ ì™„ë£Œ: ì„±ê³µ ${data.successCount}ê°œ, ì‹¤íŒ¨ ${data.failureCount}ê°œ`);
                    pendingScanCodes = [];
                    updatePendingCount();
                } else {
                    showScanResult(false, data.error || 'ì¼ê´„ ì²˜ë¦¬ ì‹¤íŒ¨');
                }
            })
            .catch(error => {
                console.error('ì¼ê´„ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                showScanResult(false, 'ì¼ê´„ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ëŒ€ê¸° ì¤‘ì¸ í•­ëª© ìˆ˜ ì—…ë°ì´íŠ¸
        function updatePendingCount() {
            document.getElementById('pendingCount').textContent = pendingScanCodes.length;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            setScanType('INBOUND');
            
            // Enter í‚¤ë¡œ ìˆ˜ë™ ì…ë ¥ ì²˜ë¦¬
            document.getElementById('manualInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    processManualInput();
                }
            });
        });
    </script>
</body>
</html>